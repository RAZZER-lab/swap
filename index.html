<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zephyr Yield Reserve - Token Swap</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="application/javascript"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button { 
            background: #4CAF50; 
            color: white; 
            padding: 10px 15px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #45a049; }
        button:disabled { 
            background: #cccccc; 
            cursor: not-allowed; 
        }
        input, select { 
            padding: 8px; 
            margin: 5px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            width: 200px;
        }
        .section { 
            margin: 15px 0; 
            padding: 15px; 
            border: 1px solid #eee; 
            border-radius: 5px;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #cce5ff; color: #004085; }
        .wallet-info { 
            background: #e9ecef; 
            padding: 10px; 
            border-radius: 5px; 
            margin-bottom: 15px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>ðŸŽ¯ Zephyr Yield Reserve</h1>
    <p>Swap between wZYS and YRS tokens</p>

    <div class="container">
        <div class="wallet-info">
            <button id="connectWallet">Connect MetaMask</button>
            <span id="walletAddress">Not connected</span>
            <div id="walletBalances"></div>
        </div>

        <div id="statusMessage" class="status hidden"></div>

        <!-- Contract Interaction Sections (shown only when connected) -->
        <div id="contractInterface" class="hidden">
            <!-- Buy YRS Section -->
            <div class="section">
                <h3>ðŸ’° Buy YRS (10% Bonus)</h3>
                <p>Swap wZYS for YRS tokens with 10% bonus</p>
                <input type="number" id="buyAmount" placeholder="wZYS amount" min="0" step="any">
                <input type="number" id="minYRSOut" placeholder="Min YRS expected" min="0" step="any">
                <button id="buyButton" onclick="buyYRS()">Buy YRS</button>
                <button onclick="approveWZYS()">Approve wZYS</button>
            </div>

            <!-- Sell YRS Section -->
            <div class="section">
                <h3>ðŸ’¸ Sell YRS (10% Penalty)</h3>
                <p>Swap YRS back to wZYS with 10% reduction</p>
                <input type="number" id="sellAmount" placeholder="YRS amount" min="0" step="any">
                <input type="number" id="minWZYSOut" placeholder="Min wZYS expected" min="0" step="any">
                <button id="sellButton" onclick="sellYRS()">Sell YRS</button>
                <button onclick="approveYRS()">Approve YRS</button>
            </div>

            <!-- Burn YRS Section -->
            <div class="section">
                <h3>ðŸ”¥ Burn YRS</h3>
                <p>Permanently remove YRS tokens from circulation</p>
                <input type="number" id="burnAmount" placeholder="YRS amount to burn" min="0" step="any">
                <button id="burnButton" onclick="burnYRS()">Burn YRS</button>
            </div>

            <!-- Contract Info Section -->
            <div class="section">
                <h3>ðŸ“Š Contract Information</h3>
                <button onclick="loadContractInfo()">Refresh Info</button>
                <div id="contractInfo"></div>
            </div>
        </div>
    </div>

    <script>
        // Contract configuration
        const CONTRACT_ADDRESS = '0x0eba64eA7d1055Cb87654EC554360741C31650E6';
        const WZYS_ADDRESS = '0x7eb81e6a8e1686de83e232c876ad2bf5e01728a4';
        const YRS_ADDRESS = '0x175c9497d14059710417935ba4817c6863ccdb55';

        // Contract ABI - You'll need to replace this with your actual ABI
        const CONTRACT_ABI = [
            // Add your contract ABI here
            // This should include buy1, sell1, burn functions
        ];

        // ERC20 ABI for token interactions
        const ERC20_ABI = [
            {
                "inputs": [{"internalType": "address","name": "account","type": "address"}],
                "name": "balanceOf",
                "outputs": [{"internalType": "uint256","name": "","type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address","name": "spender","type": "address"},
                    {"internalType": "uint256","name": "amount","type": "uint256"}
                ],
                "name": "approve",
                "outputs": [{"internalType": "bool","name": "","type": "bool"}],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        let web3Provider;
        let accounts = [];
        let stakingContract;
        let wzysToken;
        let yrsToken;

        // Check if MetaMask is installed
        function isMetaMaskInstalled() {
            return typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask;
        }

        // Connect to MetaMask wallet
        async function connectWallet() {
            if (!isMetaMaskInstalled()) {
                showStatus('MetaMask is not installed! Please install MetaMask to use this dApp.', 'error');
                return;
            }

            try {
                // Request account access
                accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                // Initialize ethers provider
                web3Provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = web3Provider.getSigner();
                
                // Initialize contract instances
                stakingContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                wzysToken = new ethers.Contract(WZYS_ADDRESS, ERC20_ABI, signer);
                yrsToken = new ethers.Contract(YRS_ADDRESS, ERC20_ABI, signer);
                
                updateWalletDisplay();
                showContractInterface();
                await loadBalances();
                await loadContractInfo();
                
                showStatus('Wallet connected successfully!', 'success');
                
                // Set up event listeners for account changes
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', handleChainChanged);
                
            } catch (error) {
                if (error.code === 4001) {
                    showStatus('User rejected connection request.', 'error');
                } else {
                    showStatus('Error connecting to wallet: ' + error.message, 'error');
                }
            }
        }

        // Handle account changes
        function handleAccountsChanged(newAccounts) {
            accounts = newAccounts;
            if (accounts.length === 0) {
                showStatus('Please connect to MetaMask.', 'error');
                hideContractInterface();
            } else {
                updateWalletDisplay();
                loadBalances();
                loadContractInfo();
            }
        }

        // Handle chain changes
        function handleChainChanged(chainId) {
            // Reload the page when network changes
            window.location.reload();
        }

        // Update wallet display
        function updateWalletDisplay() {
            if (accounts.length > 0) {
                const shortAddress = accounts[0].substring(0, 6) + '...' + accounts[0].substring(38);
                document.getElementById('walletAddress').textContent = 'Connected: ' + shortAddress;
            }
        }

        // Show contract interface after connection
        function showContractInterface() {
            document.getElementById('contractInterface').classList.remove('hidden');
        }

        function hideContractInterface() {
            document.getElementById('contractInterface').classList.add('hidden');
        }

        // Load token balances
        async function loadBalances() {
            if (accounts.length === 0) return;

            try {
                const userAddress = accounts[0];
                const wzysBalance = await wzysToken.balanceOf(userAddress);
                const yrsBalance = await yrsToken.balanceOf(userAddress);

                const formattedWZYS = ethers.utils.formatUnits(wzysBalance, 18);
                const formattedYRS = ethers.utils.formatUnits(yrsBalance, 18);

                document.getElementById('walletBalances').innerHTML = 
                    `wZYS Balance: ${formattedWZYS} | YRS Balance: ${formattedYRS}`;

            } catch (error) {
                console.error('Error loading balances:', error);
            }
        }

        // Load contract information
        async function loadContractInfo() {
            if (!stakingContract) return;

            try {
                // Add your contract info loading logic here
                document.getElementById('contractInfo').innerHTML = `
                    <p>Contract loaded successfully</p>
                    <p>Address: ${CONTRACT_ADDRESS}</p>
                `;
            } catch (error) {
                console.error('Error loading contract info:', error);
            }
        }

        // Token approval functions
        async function approveWZYS() {
            try {
                const amount = ethers.utils.parseUnits('1000000', 18);
                const tx = await wzysToken.approve(CONTRACT_ADDRESS, amount);
                await tx.wait();
                showStatus('wZYS approval successful!', 'success');
            } catch (error) {
                showStatus('wZYS approval failed: ' + error.message, 'error');
            }
        }

        async function approveYRS() {
            try {
                const amount = ethers.utils.parseUnits('1000000', 18);
                const tx = await yrsToken.approve(CONTRACT_ADDRESS, amount);
                await tx.wait();
                showStatus('YRS approval successful!', 'success');
            } catch (error) {
                showStatus('YRS approval failed: ' + error.message, 'error');
            }
        }

        // Contract interaction functions
        async function buyYRS() {
            // Implement buyYRS function
            showStatus('Buy function - implement your logic here', 'info');
        }

        async function sellYRS() {
            // Implement sellYRS function
            showStatus('Sell function - implement your logic here', 'info');
        }

        async function burnYRS() {
            // Implement burnYRS function
            showStatus('Burn function - implement your logic here', 'info');
        }

        // Utility function to show status messages
        function showStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            statusElement.classList.remove('hidden');
            
            setTimeout(() => {
                statusElement.classList.add('hidden');
            }, 5000);
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            
            if (isMetaMaskInstalled()) {
                showStatus('MetaMask detected! Click connect to continue.', 'info');
            } else {
                showStatus('MetaMask not found. Please install MetaMask.', 'error');
            }
        });
    </script>
</body>
</html>
